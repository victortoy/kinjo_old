<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
	<title>Usuarios</title>
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col">
				<form id="formulario">
					<div class="card">
						<div class="card-header">
							Usuarios
						</div>
						<div class="card-body">
							<div class="mb-3">
								<label class="form-label">Nombres</label>
								<input type="text" name="nombres" id="nombres" class="form-control" required="required">
							</div>
							<div class="mb-3">
								<label class="form-label">Apellidos</label>
								<input type="text" name="apellidos" id="apellidos" class="form-control" required="required">
							</div>
							<div class="mb-3">
								<label class="form-label">Correo</label>
								<input type="email" name="correo" id="correo" class="form-control" required="required">
							</div>
							<div class="mb-3">
								<label class="form-label">Teléfono</label>
								<input type="number" name="telefono" id="telefono" class="form-control">
							</div>
							<div class="mb-3">
								<label class="form-label">Fecha nacimiento</label>
								<input type="date" name="fecha_nacimiento" id="fecha_nacimiento" class="form-control">
							</div>
						</div>
						<div class="card-footer text-center">
							<button type="submit" class="btn btn-primary" id="botonGuardar">Guardar</button>
							<button type="button" class="btn btn-secondary" id="botonActualizar">Actualizar</button>
						</div>
					</div>
				</form>
			</div>
			<div class="col">
				<table class="table">
					<thead>
						<tr>
							<th>Nombre</th>
							<th>Correo</th>
							<th>Teléfono</th>
							<th>Opciones</th>
						</tr>
					</thead>
					<tbody id="contenido"></tbody>
				</table>
			</div>
		</div>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="../assets/main.js"></script>
	<script>
		var id = 0

		$(function(){
			//Ocultar boton actualizar
			$('#botonActualizar').hide()

			enviarPeticion('usuarios', 'consultar', {1:1}, function(res){
				for(let i = 0; i < res.datos.length; i++){
					$('#contenido').append(`<tr id = ${res.datos[i].id}>
						<td>${res.datos[i].nombres}</td>
						<td>${res.datos[i].correo}</td>
						<td>${res.datos[i].telefono}</td>
						<td>
							<button class="btn btn-primary" onClick="editar(${res.datos[i].id})">Editar</button>
							<button class="btn btn-danger" onClick="borrar(${res.datos[i].id})">Borrar</button>
						</td>
					</tr>`)	
				}
			})

			$('#formulario').on('submit', function(event){
				event.preventDefault()
				let datos = parsearFormulario($(this))
				enviarPeticion('usuarios', 'insertar', datos, function(res){					
					$('#contenido').append(`<tr id = ${res.insertId}>
						<td>${datos.nombres}</td>
						<td>${datos.correo}</td>
						<td>${datos.telefono}</td>
						<td>
							<button class="btn btn-primary" onClick="editar(${res.insertId})">Editar</button>
							<button class="btn btn-danger" onClick="borrar(${res.insertId})">Borrar</button>
						</td>
					</tr>`)
				})
			})

			$('#botonActualizar').on('click', function(){
				let datos = parsearFormulario($('#formulario'))
				datos.id = id
				console.log(datos)
				enviarPeticion('usuarios', 'actualizar', datos, function(r){

				})
			})
		})

		function editar(idU){
			id = idU
			enviarPeticion('usuarios', 'consultarId', {id:idU}, function(r){
				console.log(r)
				for(let clave in r.datos[0]){
					$('#'+clave).val(r.datos[0][clave])
				}
				$('#botonGuardar').hide()
				$('#botonActualizar').show()	
			})			
		}

		function borrar(id){
			enviarPeticion('usuarios', 'eliminar', {id: id}, function(res){
				$('#'+id).hide()
			})
		}
	</script>
</body>
</html>